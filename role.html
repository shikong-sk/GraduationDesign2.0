<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta roleId="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <script src="Assets/js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="Assets/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="Assets/js/popper.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="Assets/js/vue.js" type="text/javascript" charset="utf-8"></script>
    <script src="Assets/js/axios.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="Assets/js/qs.min.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="Assets/css/bootstrap.min.css" />

    <link rel="stylesheet" type="text/css" href="Assets/css/swiper.min.css" />

    <script src="Assets/js/swiper.min.js" type="text/javascript" charset="utf-8"></script>

    <script src="Assets/js/element-ui.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css" href="Assets/css/element-ui.css" />

    <script src="Assets/js/vuex.js" type="text/javascript" charset="utf-8"></script>

    <script src="Assets/js/tinymce/tinymce.min.js" type="text/javascript" charset="utf-8"></script>

    <script src="Assets/js/jquery.base64.js" type="text/javascript" charset="utf-8"></script>

    <script src="Assets/js/echarts.min.js" type="text/javascript" charset="utf-8"></script>

    <style type="text/css">
        .text-danger {
            color: #F56C6C !important;
        }
        
        [v-cloak] {
            display: none;
        }
    </style>

    <script type="text/javascript">
        //公用函数定义
        function sleep(fun, ms) {
            setTimeout(fun, ms);
        }

        function loop(fun, ms) {
            fun();
            setInterval(fun, ms);
        }

        addEventListener(
            "load",
            function() {
                setTimeout(hideURLbar, 0);
            },
            false
        );

        function hideURLbar() {
            window.scrollTo(0, 1);
        }
    </script>
</head>

<body class="body">

    <div id="role" v-cloak>
        <el-row v-if="roleFlag">
            <el-col :sm="4" class="text-center">
                <img style="max-width: 120px;max-height: 50px;text-align: center;" src="Storage/global/Logo.png" alt="logo" class="img-fluid">
            </el-col>
            <el-col :sm="16" :xs="24">
                <el-menu :default-active="activeIndex" mode="horizontal" @select="handleSelect">
                    <el-menu-item index="1" @click="linkTo('./management.html')">平台概览</el-menu-item>
                    <el-menu-item index="2" @click="linkTo('./personnel.html')">人员管理</el-menu-item>
                    <el-menu-item index="3" @click="linkTo('./car.html')">车辆管理</el-menu-item>
                    <el-menu-item index="4" @click="linkTo('./equipment.html')">设备管理</el-menu-item>
                    <el-menu-item v-if="role == '超级管理员' " index="6" @click="linkTo('./plan.html')">区域/场所管理</el-menu-item>
                    <el-menu-item v-if="role == '超级管理员' " index="7" @click="linkTo('./userManagement.html')">用户管理</el-menu-item>
                    <el-menu-item v-if="role == '超级管理员' " index="8" @click="linkTo('./role.html')">权限管理</el-menu-item>
                </el-menu>
            </el-col>
            <el-col :md="4" :xs="24">
                <el-row>
                    <el-col :span="12" v-if="role != '超级管理员'">
                        <div style="padding-top: 10px; text-align: center;" class="mx-auto">
                            <div>{{dareaName}}</div>
                            <div @click="()=>{areaDialog = true}" class="mx-auto w-100" style="font-size: 0.95rem;line-height: calc(0.95rem * 2);">
                                切换区域
                            </div>
                        </div>
                    </el-col>

                    <el-col :span="role != '超级管理员'?12:24">
                        <div style="padding-top: 10px; text-align: center;" class="mx-auto">
                            <el-dropdown class="text-center">
                                <span class="el-dropdown-link">
										{{role}}<br><span style="display: inline-block; width: 100%;">{{userName}}</span><i class="el-icon-arrow-down el-icon--right"></i>
                                </span>
                                <el-dropdown-menu slot="dropdown">
                                    <el-dropdown-item><span @click="linkTo('./')">返回首页</span></el-dropdown-item>
                                    <el-dropdown-item divided>
                                        <div @click="(x)=>{logout()}">退出登录</div>
                                    </el-dropdown-item>
                                </el-dropdown-menu>
                            </el-dropdown>
                        </div>
                    </el-col>
                </el-row>
            </el-col>
        </el-row>

        <el-row>
            <el-col class="text-center border" :xs="24" :sm="24" :md="24">
                <h5>权限管理</h5>
            </el-col>

            <div>
                <el-row>
                    <el-col :sm="12" :xs="12" :md="4">
                        <el-cascader placeholder="请选择区域" class="w-100" @change="(v)=>{
                            log(v)
                            loadArea2( v[ v.length - 1]);
                            log(v[ v.length - 1])
                            roleData.searchArea = v[ v.length - 1];
                            log(roleData.searchArea)
                            roleData.searchDarea = '';
                        }" :options="areaOptions" :props="areaProps">
                        </el-cascader>
                    </el-col>
                    <el-col :sm="12" :xs="12" :md="4">
                        <el-select class="w-100" v-model="roleData.searchDarea" remote :remote-method="(v)=>{}" filterable placeholder="请选择场所" :disabled="roleData.searchArea == null || roleData.searchArea.length == 0">
                            <el-option v-for="(v,k) in dareaList" :key="k" :label="v.dareaName" :value="v.darea">
                            </el-option>
                        </el-select>
                    </el-col>

                    <el-col :xs="24" :sm="12" :md="4">
                        <el-select class="w-100" v-model="roleData.filter.id" remote :remote-method="(v)=>{searchUser(v);adminUser = {};}" @change="(v)=>{
                            userList.forEach((x)=>{
                                if(v == x.userName)
                                {
                                    data.name = x.name
                                    adminUser = x
                                    data.id = adminUser.id
                                    return
                                }
                            })
                        }" filterable placeholder="按用户名搜索">
                            <el-option v-for="(v,k) in userList" :key="k" :label="v.userName" :value="v.id">
                            </el-option>
                    </el-col>


                    <el-col :xs="12" :sm="12" :md="4">
                        <el-button type="primary" plain class="w-100" @click="()=>{showAddRoleDialog()}">添加权限</el-button>
                    </el-col>

                    <el-col :xs="12" :sm="12" :md="4">
                        <el-button type="danger" class="w-100" @click="()=>{batchDel()}">批量删除</el-button>
                    </el-col>


                    <el-col :xs="24" :sm="24" :md="4">
                        <el-button type="primary" class="w-100" @click="()=>{search(Tab)}">搜索</el-button>
                    </el-col>

                </el-row>
            </div>

            <el-col class="text-center border" :xs="24" :sm="24" :md="24">
                <el-table ref="roleTable" :data="roleData.data" style="width: 100%" border>
                    <el-table-column type="selection" width="35" class="text-center"></el-table-column>
                    <el-table-column label="行政区域代码" :show-overflow-tooltip="true" width="110">
                        <template slot-scope="scope">
								{{scope.row.areaCode}}
							</template>
                    </el-table-column>
                    <el-table-column label="行政区域名称" :show-overflow-tooltip="true">
                        <template slot-scope="scope">
								{{scope.row.areaName}}
							</template>
                    </el-table-column>
                    <el-table-column label="场所代码" :show-overflow-tooltip="true" width="180">
                        <template slot-scope="scope">
								{{scope.row.dareaCode}}
							</template>
                    </el-table-column>
                    <el-table-column label="场所" :show-overflow-tooltip="true">
                        <template slot-scope="scope">
								{{scope.row.dareaName}}
							</template>
                    </el-table-column>
                    <el-table-column label="用户ID" :show-overflow-tooltip="true">
                        <template slot-scope="scope">
								{{scope.row.id}}
							</template>
                    </el-table-column>

                    <el-table-column fixed="right" label="操作" width="60">
                        <template slot-scope="scope">
								<div class="text-center">
									<el-button style="padding:5px 0;margin:0 auto" @click="select(scope)" type="text" size="small">查看</el-button>
									<el-button v-if="permission == '8' || dareaList[scope.row.area].darea[scope.row.darea].updateRole" style="padding:5px 0;margin:0 auto"
									 type="text" size="small" @click="edit(scope)">修改</el-button>
									<el-button v-if="permission == '8' || dareaList[scope.row.area].darea[scope.row.darea].delRole" style="padding:5px 0;margin:0 auto"
									 type="text" size="small" @click="del(scope)">删除</el-button>
								</div>
							</template>
                    </el-table-column>
                </el-table>
                <el-pagination @size-change="(v)=>{roleData.num = v ;CurrentChange(roleData.page) }" @current-change="(v)=>{CurrentChange(v)}" :total="roleData.count" :current-page.sync="roleData.page" :page-sizes="[10,20,50,100,200,500,1000]" :page-size="roleData.num"
                    layout="total,sizes,prev, pager, next, jumper">
                </el-pagination>
        </el-row>


        <el-dialog title="权限详细信息" :visible.sync="roleDialog" :show-close="true" :close-on-press-escape="false" :close-on-click-modal="false" :fullscreen="false">
            <el-row>
                <el-row style="vertical-align: middle;">
                    <el-col :xs="24" :sm="12" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="区域代码">
                                <span>{{data.areaCode}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="12" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="区域名称">
                                <span>{{data.areaName}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="12" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="场所代码">
                                <span>{{data.dareaCode}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="12" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="场所名称">
                                <span>{{data.dareaName}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>


                    <el-col :xs="24" :sm="24" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="管理员用户ID">
                                <span>{{data.id}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="管理员用户名">
                                <span>{{data.userName}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="管理员姓名">
                                <span>{{data.name}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="管理员联系方式">
                                <span>{{data.contact}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="管理员邮箱">
                                <span>{{data.email}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :span="24">
                        <el-divider content-position="left">权限信息</el-divider>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="24">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="人员权限">
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :span="24">
                        <el-row>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag>
                                    查询人员 &nbsp;
                                    <el-switch v-model="data.selectPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="success">
                                    添加人员 &nbsp;
                                    <el-switch v-model="data.addPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="warning">
                                    更新人员 &nbsp;
                                    <el-switch v-model="data.updatePersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="danger">
                                    删除人员 &nbsp;
                                    <el-switch v-model="data.delPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>
                        </el-row>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="24">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="车辆权限">
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :span="24">
                        <el-row>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag>
                                    查询车辆 &nbsp;
                                    <el-switch v-model="data.selectCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="success">
                                    添加车辆 &nbsp;
                                    <el-switch v-model="data.addCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="warning">
                                    更新车辆 &nbsp;
                                    <el-switch v-model="data.updateCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="danger">
                                    删除车辆 &nbsp;
                                    <el-switch v-model="data.delCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>
                        </el-row>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="24">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="设备权限">
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :span="24">
                        <el-row>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag>
                                    查询设备 &nbsp;
                                    <el-switch v-model="data.selectEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="success">
                                    添加设备 &nbsp;
                                    <el-switch v-model="data.addEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="warning">
                                    更新设备 &nbsp;
                                    <el-switch v-model="data.updateEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="danger">
                                    删除设备 &nbsp;
                                    <el-switch v-model="data.delEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0" disabled>
                                    </el-switch>
                                </el-tag>
                            </el-col>
                        </el-row>
                    </el-col>

                </el-row>
            </el-row>

            <span slot="footer" class="dialog-footer">
					<el-button type="primary" @click="()=>{roleDialog = false;}">确 定</el-button>
				</span>
        </el-dialog>

        <el-dialog v-if="data" title="权限信息修改" :visible.sync="roleEditDialog" :show-close="true" :close-on-press-escape="false" :close-on-click-modal="false" :fullscreen="false">
            <el-row>
                <el-row style="vertical-align: middle;">

                    <el-row>
                        <!-- <el-col :sm="12" :xs="12" :md="12">
                            <el-cascader placeholder="请选择区域" class="w-100" @change="(v)=>{
                                loadArea2( v[ v.length - 1]);
                                data.area = v[ v.length - 1];
                                data.darea = '';
                            }" :options="areaOptions" :props="areaProps">
                            </el-cascader>
                        </el-col>

                        <el-col :sm="12" :xs="12" :md="12">
                            <el-select class="w-100" v-model="data['darea']" remote :remote-method="(v)=>{}" @change="
                                    (v)=>{
                                        this.$set(data,'darea',v)
                                        this.$forceUpdate()
                                    }
                                " filterable placeholder="请选择场所" :disabled="data.area == null || data.area.length == 0">
                                <el-option v-for="(v,k) in dareaList" :key="k" :label="v.dareaName" :value="v.darea">
                                </el-option>
                            </el-select>
                        </el-col> -->

                        <!-- <el-col :xs="24" :sm="24" :md="24">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="活动时间">
                                    <span>{{data.checkTime}}</span>
                                </el-form-item>
                            </el-form>
                        </el-col> -->

                        <el-col :xs="24" :sm="12" :md="12">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="区域代码">
                                    <span>{{data.area}}</span>
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :xs="24" :sm="12" :md="12">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="区域名称">
                                    <span>{{data.areaName}}</span>
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :xs="24" :sm="12" :md="12">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="场所代码">
                                    <span>{{data.dareaCode}}</span>
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :xs="24" :sm="12" :md="12">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="场所名称">
                                    <span>{{data.dareaName}}</span>
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="24">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="管理员用户ID">
                                    <span>{{data.id}}</span>
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="12">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="管理员用户名">
                                    <!-- <span>{{data.userName}}</span> -->
                                    <el-select v-model="data.userName" remote :remote-method="(v)=>{searchUser(v);adminUser = {};}" @change="(v)=>{
                                            userList.forEach((x)=>{
                                                if(v == x.userName)
                                                {
                                                    data.name = x.name
                                                    adminUser = x
                                                    data.id = adminUser.id
                                                    return
                                                }
                                            })
                                        }" filterable placeholder="请选择">
                                        <el-option v-for="(v,k) in userList" :key="k" :label="v.userName" :value="v.userName">
                                        </el-option>
                                    </el-select>
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="12">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="管理员姓名">
                                    <!-- <span>{{data.name}}</span> -->
                                    <el-select v-model="data.name" remote :remote-method="(v)=>{searchUser('',v);adminUser = {};}" @change="(v)=>{
                                            userList.forEach((x)=>{
                                                if(v == x.name)
                                                {
                                                    data.userName = x.userName
                                                    adminUser = x
                                                    data.id = adminUser.id
                                                    return
                                                }
                                            })
                                        }" filterable placeholder="请选择">
                                        <el-option v-for="(v,k) in userList" :key="k" :label="v.userName + ':' + v.name" :value="v.name">
                                        </el-option>
                                    </el-select>
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :span="24">
                            <el-divider content-position="left">权限信息</el-divider>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="24">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="人员权限">
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :span="24">
                            <el-row>
                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag>
                                        查询人员 &nbsp;
                                        <el-switch v-model="data.selectPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>

                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="success">
                                        添加人员 &nbsp;
                                        <el-switch v-model="data.addPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>
                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="warning">
                                        更新人员 &nbsp;
                                        <el-switch v-model="data.updatePersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>

                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="danger">
                                        删除人员 &nbsp;
                                        <el-switch v-model="data.delPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>
                            </el-row>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="24">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="车辆权限">
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :span="24">
                            <el-row>
                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag>
                                        查询车辆 &nbsp;
                                        <el-switch v-model="data.selectCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>

                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="success">
                                        添加车辆 &nbsp;
                                        <el-switch v-model="data.addCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>
                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="warning">
                                        更新车辆 &nbsp;
                                        <el-switch v-model="data.updateCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>

                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="danger">
                                        删除车辆 &nbsp;
                                        <el-switch v-model="data.delCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>
                            </el-row>
                        </el-col>

                        <el-col :xs="24" :sm="24" :md="24">
                            <el-form label-position="left" inline class="table-expand">
                                <el-form-item label="设备权限">
                                </el-form-item>
                            </el-form>
                        </el-col>

                        <el-col :span="24">
                            <el-row>
                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag>
                                        查询设备 &nbsp;
                                        <el-switch v-model="data.selectEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>

                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="success">
                                        添加设备 &nbsp;
                                        <el-switch v-model="data.addEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>
                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="warning">
                                        更新设备 &nbsp;
                                        <el-switch v-model="data.updateEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>

                                <el-col :xs="12" :sm="12" :md="6">
                                    <el-tag type="danger">
                                        删除设备 &nbsp;
                                        <el-switch v-model="data.delEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                        </el-switch>
                                    </el-tag>
                                </el-col>
                            </el-row>
                        </el-col>

                    </el-row>
                </el-row>
            </el-row>

            <span slot="footer" class="dialog-footer">
					<el-button @click="()=>{CurrentChange();roleEditDialog = false}">取 消</el-button>
					<el-button type="primary" @click="()=>{update(data)}">确 定</el-button>
				</span>
        </el-dialog>

        <el-dialog title="设备信息添加" :visible.sync="roleAddDialog" :show-close="true" :close-on-press-escape="false" :close-on-click-modal="false" :fullscreen="false">
            <el-row>
                <el-row>
                    <el-col :sm="12" :xs="12" :md="12">
                        <el-cascader placeholder="请选择区域" class="w-100" @change="(v)=>{
                            loadArea2( v[ v.length - 1]);
                            data.area = v[ v.length - 1];
                            data.darea = '';
                        }" :options="areaOptions" :props="areaProps">
                        </el-cascader>
                    </el-col>

                    <el-col :sm="12" :xs="12" :md="12">
                        <el-select class="w-100" v-model="data['darea']" remote :remote-method="(v)=>{}" @change="
                                (v)=>{
                                    this.$set(data,'darea',v)
                                    this.$forceUpdate()
                                }
                            " filterable placeholder="请选择场所" :disabled="data.area == null || data.area.length == 0">
                            <el-option v-for="(v,k) in dareaList" :key="k" :label="v.dareaName" :value="v.darea">
                            </el-option>
                        </el-select>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="24">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="活动时间">
                                <span>{{data.checkTime}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="12" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="区域代码">
                                <span>{{data.area}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="12" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="区域名称">
                                <span>{{data.areaName}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="12" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="场所代码">
                                <span>{{data.darea}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="12" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="场所名称">
                                <span>{{data.dareaName}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="24">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="管理员用户ID">
                                <span>{{data.id}}</span>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="管理员用户名">
                                <!-- <span>{{data.userName}}</span> -->
                                <el-select v-model="data.userName" remote :remote-method="(v)=>{searchUser(v);adminUser = {};}" @change="(v)=>{
                                        userList.forEach((x)=>{
                                            if(v == x.userName)
                                            {
                                                data.name = x.name
                                                adminUser = x
                                                data.id = adminUser.id
                                                return
                                            }
                                        })
                                    }" filterable placeholder="请选择">
                                    <el-option v-for="(v,k) in userList" :key="k" :label="v.userName" :value="v.userName">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="12">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="管理员姓名">
                                <!-- <span>{{data.name}}</span> -->
                                <el-select v-model="data.name" remote :remote-method="(v)=>{searchUser('',v);adminUser = {};}" @change="(v)=>{
                                        userList.forEach((x)=>{
                                            if(v == x.name)
                                            {
                                                data.userName = x.userName
                                                adminUser = x
                                                data.id = adminUser.id
                                                return
                                            }
                                        })
                                    }" filterable placeholder="请选择">
                                    <el-option v-for="(v,k) in userList" :key="k" :label="v.userName + ':' + v.name" :value="v.name">
                                    </el-option>
                                </el-select>
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :span="24">
                        <el-divider content-position="left">权限信息</el-divider>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="24">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="人员权限">
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :span="24">
                        <el-row>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag>
                                    查询人员 &nbsp;
                                    <el-switch v-model="data.selectPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="success">
                                    添加人员 &nbsp;
                                    <el-switch v-model="data.addPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="warning">
                                    更新人员 &nbsp;
                                    <el-switch v-model="data.updatePersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="danger">
                                    删除人员 &nbsp;
                                    <el-switch v-model="data.delPersonnel" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>
                        </el-row>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="24">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="车辆权限">
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :span="24">
                        <el-row>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag>
                                    查询车辆 &nbsp;
                                    <el-switch v-model="data.selectCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="success">
                                    添加车辆 &nbsp;
                                    <el-switch v-model="data.addCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="warning">
                                    更新车辆 &nbsp;
                                    <el-switch v-model="data.updateCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="danger">
                                    删除车辆 &nbsp;
                                    <el-switch v-model="data.delCar" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>
                        </el-row>
                    </el-col>

                    <el-col :xs="24" :sm="24" :md="24">
                        <el-form label-position="left" inline class="table-expand">
                            <el-form-item label="设备权限">
                            </el-form-item>
                        </el-form>
                    </el-col>

                    <el-col :span="24">
                        <el-row>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag>
                                    查询设备 &nbsp;
                                    <el-switch v-model="data.selectEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="success">
                                    添加设备 &nbsp;
                                    <el-switch v-model="data.addEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>
                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="warning">
                                    更新设备 &nbsp;
                                    <el-switch v-model="data.updateEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>

                            <el-col :xs="12" :sm="12" :md="6">
                                <el-tag type="danger">
                                    删除设备 &nbsp;
                                    <el-switch v-model="data.delEquipment" active-color="#13ce66" inactive-color="#ff4949" active-value="1" inactive-value="0">
                                    </el-switch>
                                </el-tag>
                            </el-col>
                        </el-row>
                    </el-col>

                </el-row>
            </el-row>

            <span slot="footer" class="dialog-footer">
					<el-button @click="()=>{CurrentChange();roleAddDialog = false}">取 消</el-button>
					<el-button type="primary" @click="()=>{add(data)}">确 定</el-button>
				</span>
        </el-dialog>


    </div>
    <script>
        var role = new Vue({
            el: '#role',
            watch: {},
            computed: {},
            mounted() {},
            data() {
                return {

                    areaOptions: [],

                    areaProps: {
                        lazy: true,
                        value: 'area',
                        label: 'areaName',
                        children: "children",
                        checkStrictly: true,
                        lazyLoad(node, resolve) {
                            const {
                                level
                            } = node;

                            // if (level < 3) {
                            //     substrNum = (level + 1) * 2
                            // }

                            // console.log(node);
                            // return

                            axios.post('./System/Core/Management.php', Qs.stringify({
                                'getAreaList': '',
                                'page': '1',
                                'num': '9999999999999',
                                'filter': JSON.stringify({
                                    'level': level,
                                    'areaLike': level == 0 ? '' : node.value.substr(0, (level - 1) * 2)
                                })
                            }), ).then(function(res) {
                                if (res.data[0] != 0) {
                                    // console.log(res.data.slice(1))
                                }
                                data = res.data.slice(1)
                                var nodes = [];

                                // var nodes = Array.from({
                                //     length: level + 1
                                // }).map(item => ({
                                //     area: ++id,
                                //     areaName: `选项${id}`,
                                //     leaf: level >= 4
                                // }));
                                data.forEach((x) => {
                                    nodes.push({
                                        area: x.area,
                                        areaName: x.areaName,
                                        leaf: level >= 4
                                    })
                                })

                                // console.log(level, node, nodes, resolve, res.data)
                                resolve(nodes);
                            })

                            // 通过调用resolve将子节点数据返回，通知组件数据加载完成

                        }
                        // lazyLoad(node, resolve) {
                        //     // const {
                        //     //     level
                        //     // } = node;

                        //     // plan.console(node, resolve)
                        //     // plan.areaLevelLoad(node.level)
                        //     resolve(resolve)
                        // }
                    },

                    roleDialog: false,
                    roleAddDialog: false,
                    roleEditDialog: false,
                    roleNum: 0,

                    fileData: '',

                    firstLoadDialog: true,
                    areaDialog: false,

                    roleFlag: false,
                    activeIndex: '8',
                    userName: '',
                    role: "",
                    permission: "",

                    Tab: "权限管理",

                    data: {},
                    userInfo: "",

                    dialogWidth: 0,

                    roleListPage: 1,
                    roleListNum: 1000,

                    roleList: [],

                    areaList: {},
                    area: '',
                    areaName: '',
                    dareaList: {},
                    darea: "",
                    dareaName: '',
                    roleList: [],

                    userList: [],
                    adminUser: {},

                    roleData: {
                        data: [],
                        count: 0,
                        num: 10,
                        page: 1,
                        timeFilter: '0',
                        tempFilter: '0',
                        compareScoreFilter: '0',
                        searchPlan: 0,
                        searchArea: '',
                        searchDarea: '',
                        filter: {
                            roleId: '',
                            address: undefined,
                            checkTime: undefined,
                            beforeTime: undefined,
                            afterTime: undefined,
                            betweenTime: undefined,
                            roleId: undefined,
                            roleName: undefined,
                            roleType: undefined,
                            roleStatus: undefined,
                            placeType: undefined,
                        },
                    },
                }
            },
            created() {
                this.setDialogWidth()
                this.GetRequest()
            },
            methods: {
                searchUser(userName, name) {
                    if (name == null) {
                        axios.post('./System/Core/Management.php', Qs.stringify({
                            "getUserList": '',
                            "page": "1",
                            "num": "9999999999999",
                            "filter": JSON.stringify({
                                "userName": userName,
                            })
                        }), ).then(function(res) {
                            role.userList = res.data.slice(1)
                        })
                    } else {
                        axios.post('./System/Core/Management.php', Qs.stringify({
                            "getUserList": '',
                            "page": "1",
                            "num": "9999999999999",
                            "filter": JSON.stringify({
                                "name": name,
                            })
                        }), ).then(function(res) {
                            role.userList = res.data.slice(1)
                        })
                    }
                    console.log(userName, name)
                },
                log(v) {
                    console.log(v)
                },
                batchDel() {
                    if (role.$refs.roleTable.selection.length != 0) {
                        role.$refs.roleTable.selection.forEach((x) => {
                            // console.log(x)
                            this.del(x)
                        })
                    } else {
                        role.$message({
                            showClose: true,
                            message: '请先选择要删除的项目',
                            type: 'info'
                        });
                    }
                },
                getRole(area, darea) {
                    axios.post('./System/Core/Management.php', Qs.stringify({
                        "getRoleList": '',
                        "page": "1",
                        "num": "9999999999999",
                        "area": area,
                        "darea": darea,
                    }), ).then(function(res) {
                        if ('error' in res.data) {
                            role.$message({
                                showClose: true,
                                message: '没有查询 ' + role.dareaList[area].darea[darea].dareaName + ' 设备的权限，无法选择设备信息',
                                type: 'error',
                                duration: 5000
                            });
                        } else {
                            role.roleList = res.data.slice(1)
                            console.log(role.roleList)
                        }
                    })
                },
                loadArea2(v) {
                    axios.post('./System/Core/Management.php', Qs.stringify({
                        "getPlanList": '',
                        "page": "1",
                        "num": "9999999999999",
                        "filter": JSON.stringify({
                            "area": v,
                        })
                    }), ).then(function(res) {
                        // data = res.data.slice(1)
                        role.dareaList = res.data.slice(1)
                    })
                },
                loadArea(v) {
                    if (role.permission != '8') {
                        return role.areaList
                    }

                    if (v.length != 0) {
                        role.areaList = {}

                        axios.post('./System/Core/Management.php', Qs.stringify({
                            "getPlanList": '',
                            "page": "1",
                            "num": "9999999999999",
                            "filter": JSON.stringify({
                                "areaName": v,
                            })
                        }), ).then(function(res) {
                            data = res.data.slice(1)
                            for (t in data) {

                                if (!(data[t]['area'] in role.areaList)) {
                                    role.areaList[data[t]['area']] = {
                                        'areaName': data[t]['areaName']
                                    }
                                }

                                // console.log(role.areaList,role.roleList[t]['areaCode'],role.roleList[t]['areaName'])

                                if (!(data[t]['area'] in role.dareaList)) {
                                    role.dareaList[data[t]['area']] = {
                                        'areaName': data[t]['areaName'],
                                        'darea': {}
                                    }
                                }

                                if (!(data[t]['darea'] in role.dareaList[data[t]['area']]['darea'])) {
                                    role.dareaList[data[t]['area']]['darea'][data[t]['darea']] = {
                                        'dareaName': data[t]['dareaName'],
                                    }
                                }
                            }
                            role.$set(role.areaList, role.areaList)
                            role.$set(role.dareaList, role.dareaList)
                        })
                    }

                },
                add(data) {
                    for (x in data) {

                        if (x == 'area' && (data[x] == null || data[x].length == 0)) {
                            role.$message({
                                showClose: true,
                                message: '请选择区域',
                                type: 'error'
                            });
                            return
                        } else if (x == 'darea' && (data[x] == null || data[x].length == 0)) {
                            role.$message({
                                showClose: true,
                                message: '请选择场所',
                                type: 'error'
                            });
                            return
                        } else if (x == 'id' && (data[x] == null || data[x].length == 0)) {
                            role.$message({
                                showClose: true,
                                message: '请选择用户',
                                type: 'error'
                            });
                            return
                        }

                        if (data[x] == null || data[x].length == 0) {
                            data[x] = undefined
                        }

                    }

                    axios.post('./System/Core/Management.php', Qs.stringify({
                        "addRole": '',
                        'area': data.area,
                        'darea': data.darea,
                        "data": JSON.stringify(data)
                    }), ).then(function(res) {
                        if ('success' in res.data) {
                            role.$message({
                                showClose: true,
                                message: res.data.success,
                                type: 'success'
                            });
                            role.roleEditDialog = false;
                        }
                        if ('error' in res.data) {
                            role.$message({
                                showClose: true,
                                message: res.data.error,
                                type: 'error'
                            });
                        }
                        if ('info' in res.data) {
                            role.$message({
                                showClose: true,
                                message: res.data.info,
                                type: 'info'
                            });
                            role.roleAddDialog = false;
                        }

                        role.CurrentChange()
                    })
                },
                showAddRoleDialog() {
                    role.data = {

                        selectPersonnel: 0,
                        selectCar: 0,
                        updateEquipment: 0,
                        updateCar: 0,
                        updatePersonnel: 0,
                        selectEquipment: 0,
                        addPersonnel: 0,
                        addCar: 0,
                        addEquipment: 0,
                        delPersonnel: 0,
                        delCar: 0,
                        delEquipment: 0,

                        checkTime: undefined,
                        roleId: undefined,
                        roleName: undefined,

                        area: undefined,
                        areaName: undefined,
                        darea: undefined,
                        dareaName: undefined,

                        master: undefined,
                        roleType: undefined,
                        A: undefined,

                        roleStatus: '0',
                        remark: undefined,
                        address: undefined,
                    }

                    role.roleAddDialog = true
                },
                del(data) {
                    if ('row' in data) {
                        data = data.row
                    }
                    data.area = data.areaCode
                    data.darea = data.dareaCode

                    axios.post('./System/Core/Management.php', Qs.stringify({
                        "delRole": '',
                        "data": JSON.stringify({
                            "area": data.area,
                            "darea": data.darea,
                            "id": data.id,
                        })
                    }), ).then(function(res) {
                        if ('success' in res.data) {
                            role.$message({
                                showClose: true,
                                message: res.data.success,
                                type: 'success'
                            });
                            role.roleEditDialog = false;
                        }
                        if ('error' in res.data) {
                            role.$message({
                                showClose: true,
                                message: res.data.error,
                                type: 'error'
                            });
                        }
                        role.CurrentChange()
                    })
                },
                update(data) {
                    console.log()
                    console.log(data)
                    for (x in data) {
                        // console.log(x)
                        if (data[x] == null || data[x].length == 0) {
                            data[x] = undefined
                        }

                        if (
                            (x.indexOf('birth') != -1 || x.indexOf('validty') != -1) &&
                            data[x] != null && data[x].length != 0
                        ) {
                            data[x] = role.getTime(Date.parse(data[x])).split(' ')[0]
                        }

                        if (x.indexOf('Img') != -1 && data[x] != null && data[x].indexOf('base64') == -1) {
                            data[x] = undefined
                        }
                        // console.log(x, data[x])
                    }
                    axios.post('./System/Core/Management.php', Qs.stringify({
                        "updateRole": '',
                        'area': data.area,
                        'darea': data.darea,
                        "data": JSON.stringify(data)
                    }), ).then(function(res) {
                        if ('success' in res.data) {
                            role.$message({
                                showClose: true,
                                message: res.data.success,
                                type: 'success'
                            });
                            role.roleEditDialog = false;
                        }
                        if ('error' in res.data) {
                            role.$message({
                                showClose: true,
                                message: res.data.error,
                                type: 'error'
                            });
                        }
                        if ('info' in res.data) {
                            role.$message({
                                showClose: true,
                                message: res.data.info,
                                type: 'info'
                            });
                            role.roleEditDialog = false;
                        }

                        role.CurrentChange()
                    })
                },
                idRoledImgAdd() {
                    $('#idRoledImgAdd').click()
                },
                roleImgAdd() {
                    $('#roleImgAdd').click()
                },
                async imgAdd(img, data, x) {
                    console.log(data)
                        // 生成一个文件读取的对象
                    console.log(img.files[0])
                    reader = new FileReader();
                    reader.onload = function(ev) {
                            // base64码
                            var imgFile = ev.target.result; //或e.target都是一样的
                            // console.log(imgFile)
                            // data[x] = imgFile
                            role.$set(role.data, x, imgFile)
                        }
                        //发起异步读取文件请求，读取结果为data:url的字符串形式，
                    await reader.readAsDataURL(img.files[0])
                },
                idRoledImgUpload() {
                    $('#idRoledImgUpload').click()
                },
                roleImgUpload() {
                    $('#roleImgUpload').click()
                },
                async imgChange(img, data, x) {
                    // 生成一个文件读取的对象
                    console.log(img.files[0])
                    reader = new FileReader();
                    reader.onload = function(ev) {
                            // base64码
                            var imgFile = ev.target.result; //或e.target都是一样的
                            // console.log(imgFile)
                            // data[x] = imgFile
                            role.$set(role.data, x, imgFile)
                        }
                        //发起异步读取文件请求，读取结果为data:url的字符串形式，
                    await reader.readAsDataURL(img.files[0])
                },
                edit(scope) {
                    role.data = scope.row
                    role.data.area = scope.row.areaCode
                    role.data.darea = scope.row.dareaCode
                    if (scope.row.id != null && scope.row.id.length != 0) {
                        axios.post('./System/Core/Management.php', Qs.stringify({
                            "getUserList": '',
                            "page": "1",
                            "num": "1",
                            "filter": JSON.stringify({
                                'id': scope.row.id
                            })
                        }), ).then(function(res) {
                            role.$set(role.data, 'userName', res.data[1].userName)
                            role.$set(role.data, 'name', res.data[1].name)
                            role.$set(role.data, 'contact', res.data[1].contact)
                            role.$set(role.data, 'email', res.data[1].email)
                            scope.row['userName'] = res.data[1].userName
                            scope.row['name'] = res.data[1].name
                            scope.row['contact'] = res.data[1].contact
                            scope.row['email'] = res.data[1].email
                            console.log(scope.row)
                        })
                    }
                    role.roleEditDialog = true
                },
                searchDarea(v) {
                    console.log(v)
                },
                select(scope) {
                    role.data = scope.row
                    if (scope.row.id != null && scope.row.id.length != 0) {
                        axios.post('./System/Core/Management.php', Qs.stringify({
                            "getUserList": '',
                            "page": "1",
                            "num": "1",
                            "filter": JSON.stringify({
                                'id': scope.row.id
                            })
                        }), ).then(function(res) {
                            role.$set(role.data, 'userName', res.data[1].userName)
                            role.$set(role.data, 'name', res.data[1].name)
                            role.$set(role.data, 'contact', res.data[1].contact)
                            role.$set(role.data, 'email', res.data[1].email)
                            scope.row['userName'] = res.data[1].userName
                            scope.row['name'] = res.data[1].name
                            scope.row['contact'] = res.data[1].contact
                            scope.row['email'] = res.data[1].email
                            console.log(scope.row)
                        })
                    }
                    role.roleDialog = true
                },
                search() {
                    role.roleData.page = 1
                    this.CurrentChange()
                },
                CurrentChange(v) {

                    for (x in role.roleData.filter) {
                        if (role.roleData.filter[x] == null || role.roleData.filter[x].length == 0) {
                            role.roleData.filter[x] = undefined
                        }

                        if (role.roleData.searchArea == null || role.roleData.searchArea.length == 0) {
                            role.roleData.searchArea = undefined
                        }

                        if (role.roleData.searchDarea == null || role.roleData.searchDarea.length == 0) {
                            role.roleData.searchDarea = undefined
                        }

                        if (x == 'betweenTime' && role.roleData.filter[x] != null && role.roleData.filter[x].length ==
                            2) {
                            role.roleData.filter[x][0] = this.getTime(role.roleData.filter[x][0])
                            role.roleData.filter[x][1] = this.getTime(role.roleData.filter[x][1])
                        } else if (x.indexOf('Time') != -1 && role.roleData.filter[x] != null && role.roleData
                            .filter[
                                x].length != 0) {
                            role.roleData.filter[x] = this.getTime(role.roleData.filter[x])
                        }

                        // console.log(x, role.roleData.filter[x])
                    }

                    axios.post('./System/Core/Management.php', Qs.stringify({
                        "getRoleList": '',
                        'data': JSON.stringify({
                            'page': role.roleData.page,
                            'num': role.roleData.num,
                            'area': role.roleData.searchArea instanceof Array ? undefined : role.roleData.searchArea,
                            'darea': role.roleData.searchDarea instanceof Array ? undefined : role.roleData.searchDarea,
                            'filter': JSON.stringify(role.roleData.filter)
                        })
                    }), ).then(function(res) {
                        if ('error' in res.data) {
                            role.$alert(res.data.error, '错误', {
                                confirmButtonText: '确定',
                                type: 'error',
                                center: true,
                                callback: action => {
                                    // role.linkTo('./management.html')
                                }
                            })
                            return
                        }
                        role.roleData.count = parseInt(res.data[0])
                        role.roleData.data = res.data.slice(1)
                    })
                },
                change(v) {
                    if (v == null) {
                        return undefined
                    }
                    if (v.length == 0) {
                        return undefined
                    } else {
                        return v
                    }
                },
                clear() {
                    return undefined
                },
                changeUrl(k, v) {
                    history.pushState({}, '', this.changeURLArg(k, v));
                },
                changeURLArg(arg, arg_val) {
                    // var url = window.location.href.replace(window.location.search,'')
                    var url = window.location.href
                    var pattern = arg + '=([^&]*)';
                    var replaceText = arg + '=' + arg_val;
                    if (url.match(pattern)) {
                        var tmp = '/(' + arg + '=)([^&]*)/gi';
                        tmp = url.replace(eval(tmp), replaceText);
                        return tmp;
                    } else {
                        if (url.match('[\?]')) {
                            return url + '&' + replaceText;
                        } else {
                            return url + '?' + replaceText;
                        }
                    }
                    return url + '\n' + arg + '\n' + arg_val;
                },
                GetRequest() {
                    var url = location.search; //获取url中"?"符后的字串
                    var theRequest = new Object();
                    if (url.indexOf("?") != -1) {
                        var str = url.substr(1);
                        strs = str.split("&");
                        for (var i = 0; i < strs.length; i++) {
                            theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                        }
                    }
                    this.Request = theRequest
                },
                getRoleCount(page, num) {
                    time = []
                    t = role.getTime(new Date()).replace(/-/g, ' ').replace(/:/g, ' ').split(' ')
                    time[0] = t[0] + '-' + t[1] + '-' + t[2]
                    t = role.getTime(Date.parse(time[0]) + 1000 * 60 * 60 * 24).replace(/-/g, ' ').replace(/:/g, ' ').split(
                        ' ')
                    time[1] = t[0] + '-' + t[1] + '-' + t[2]

                    if (role.role == '超级管理员') {
                        data = Qs.stringify({
                            "getRoleList": '',
                            "page": "1",
                            "num": "0",
                            // "filter": JSON.stringify({
                            // 	"betweenTime": JSON.stringify(time),
                            // })
                        })
                    } else {
                        data = Qs.stringify({
                            "getRoleList": '',
                            "page": "1",
                            "num": "0",
                            'area': role.area,
                            'darea': role.darea,
                            // "filter": JSON.stringify({
                            // 	"betweenTime": JSON.stringify(time),
                            // })
                        })
                    }
                    axios.post('./System/Core/Management.php', data).then(function(res) {
                        // console.log(res)
                        role.roleNum = res.data[0]
                    })
                },
                saveDefault() {
                    sessionStorage.setItem("area", role.area)
                    sessionStorage.setItem("darea", role.darea)
                },
                loadArea(v) {
                    if (role.permission != '8') {
                        return role.areaList
                    }

                    if (v != null && v.length != 0) {
                        role.areaList = {}

                        axios.post('./System/Core/Management.php', Qs.stringify({
                            "getPlanList": '',
                            "page": "1",
                            "num": "9999999999999",
                            "filter": JSON.stringify({
                                "areaName": v,
                            })
                        }), ).then(function(res) {
                            data = res.data.slice(1)
                            for (t in data) {

                                if (!(data[t]['area'] in role.areaList)) {
                                    role.areaList[data[t]['area']] = {
                                        'areaName': data[t]['areaName']
                                    }
                                }

                                // console.log(role.areaList,role.roleList[t]['areaCode'],role.roleList[t]['areaName'])

                                if (!(data[t]['area'] in role.dareaList)) {
                                    role.dareaList[data[t]['area']] = {
                                        'areaName': data[t]['areaName'],
                                        'darea': {}
                                    }
                                }

                                if (!(data[t]['darea'] in role.dareaList[data[t]['area']]['darea'])) {
                                    role.dareaList[data[t]['area']]['darea'][data[t]['darea']] = {
                                        'dareaName': data[t]['dareaName'],
                                    }
                                }
                            }
                            role.$set(role.areaList, role.areaList)
                            role.$set(role.dareaList, role.dareaList)
                        })
                    }

                },
                loadDarea(v) {
                    role.areaName = role.dareaList[role.area].areaName
                    role.dareaName = role.dareaList[role.area].darea[role.darea].dareaName
                    role.getRoleCount()
                    role.changeUrl('area', role.area)
                    role.changeUrl('darea', role.darea)

                    role.CurrentChange()

                    role.roleData.searchPlan = role.darea
                    role.roleData.searchArea = role.area
                    role.roleData.searchDarea = role.darea

                    if (role.permission != '8') {
                        return role.dareaList
                    }

                },
                setDialogWidth() {
                    // console.log(document.body.clientWidth)
                    var val = document.body.clientWidth
                    const def = 800 // 默认宽度
                    if (val < def) {
                        this.dialogWidth = '100%'
                    } else {
                        this.dialogWidth = def + 'px'
                    }
                },
                linkTo(target) {
                    window.location = target
                },
                getSomeTime(n) {
                    return role.getTime(Date.parse(role.getTime(Math.ceil((new Date().getTime() / 100000) * 100000))
                            .split(
                                ':')[0] +
                            ':' +
                            (parseInt(role.getTime(Math.ceil(new Date().getTime() / 100000) * 100000).split(':')[1]) -
                                parseInt(
                                    role.getTime(Math.ceil(new Date().getTime() / 100000) * 100000).split(':')[1]) % 5)) + 60 * 1000 *
                        (5 *
                            n))
                },
                getTime(unixTime) {
                    unixTime = new Date(unixTime)
                    Y = unixTime.getFullYear()
                    M = (unixTime.getMonth() + 1) < 10 ? '0' + (unixTime.getMonth() + 1) : (unixTime.getMonth() + 1)
                    D = unixTime.getDate() < 10 ? '0' + unixTime.getDate() : unixTime.getDate()
                    H = unixTime.getHours() < 10 ? '0' + unixTime.getHours() : unixTime.getHours()
                    i = unixTime.getMinutes() < 10 ? '0' + unixTime.getMinutes() : unixTime.getMinutes()
                    S = unixTime.getSeconds() < 10 ? '0' + unixTime.getSeconds() : unixTime.getSeconds()
                    return Y + '-' + M + '-' + D + ' ' + H + ':' + i + ':' + S
                },
                handleSelect(key, keyPath) {
                    console.log(key, keyPath);
                },
                logout() {
                    axios.post('./System/Core/User.php', Qs.stringify({
                        "logout": '',
                    }), ).then(function(res) {
                        for (x in res.data) {
                            if ('success' === x) {
                                console.log(res.data['success'])
                                role.$alert(res.data['success'], '操作成功', {
                                    confirmButtonText: '确定',
                                    type: 'success',
                                    center: true,
                                    callback: action => {
                                        window.location = 'login.html'
                                    }
                                })
                            }
                        }
                    })
                },
            },
            mounted() {
                window.onresize = () => {
                    return (() => {
                        this.setDialogWidth()
                    })()
                }
                axios.post('./System/Core/User.php', Qs.stringify({
                    "getUserInfo": '',
                }), ).then(function(res) {
                    for (x in res.data) {
                        if ('error' === x) {
                            role.$alert(res.data[x], '错误', {
                                confirmButtonText: '确定',
                                type: 'error',
                                center: true,
                                callback: action => {
                                    window.location = 'login.html'
                                }
                            })
                        } else {
                            role.userName = res.data[x]['userName']
                            role.userInfo = res.data[x]
                            role.permission = res.data[x]['permission']

                            if (role.permission == '8') {
                                role.role = '超级管理员'
                                role.CurrentChange()
                                role.areaDialog = false
                            } else if (role.permission == '1') {
                                role.role = '管理员'
                            } else {
                                role.linkTo('./')
                            }

                            role.roleFlag = true

                            if (role.permission != '8') {
                                axios.post('./System/Core/Management.php', Qs.stringify({
                                    "getRoleList": '',
                                }), ).then(function(res) {
                                    if (res.data[0] == 0) {
                                        role.$alert('您没有访问面板的权限，如需访问请联系超级管理员添加相应权限', '错误', {
                                            confirmButtonText: '返回首页',
                                            type: 'error',
                                            center: true,
                                            callback: action => {
                                                role.linkTo('./')
                                            }
                                        })
                                    }
                                    // console.log(res.data)
                                    role.roleList = res.data.slice(1)
                                    for (t in role.roleList) {
                                        // console.log(role.roleList[t]['areaCode'])

                                        if (!(role.roleList[t]['areaCode'] in role.areaList)) {
                                            role.areaList[role.roleList[t]['areaCode']] = {
                                                'areaName': role.roleList[t]['areaName']
                                            }
                                        }

                                        console.log(role.areaList, role.roleList[t]['areaCode'], role.roleList[t]['areaName'])

                                        if (!(role.roleList[t]['areaCode'] in role.dareaList)) {
                                            role.dareaList[role.roleList[t]['areaCode']] = {
                                                'areaName': role.roleList[t]['areaName'],
                                                'darea': {}
                                            }
                                        }

                                        if (!(role.roleList[t]['dareaCode'] in role.dareaList[role.roleList[t]['areaCode']][
                                                'darea'
                                            ])) {
                                            role.dareaList[role.roleList[t]['areaCode']]['darea'][role.roleList[t]['dareaCode']] = {
                                                'dareaName': role.roleList[t]['dareaName'],

                                                'selectRole': role.roleList[t]['selectRole'] == 0 ? false : true,
                                                'selectRole': role.roleList[t]['selectRole'] == 0 ? false : true,
                                                'selectRole': role.roleList[t]['selectRole'] == 0 ? false : true,

                                                'updateRole': role.roleList[t]['updateRole'] == 0 ? false : true,
                                                'updateRole': role.roleList[t]['updateRole'] == 0 ? false : true,
                                                'updateRole': role.roleList[t]['updateRole'] == 0 ? false : true,

                                                'delRole': role.roleList[t]['delRole'] == 0 ? false : true,
                                                'delRole': role.roleList[t]['delRole'] == 0 ? false : true,
                                                'delRole': role.roleList[t]['delRole'] == 0 ? false : true,

                                                'addRole': role.roleList[t]['addRole'] == 0 ? false : true,
                                                'addRole': role.roleList[t]['addRole'] == 0 ? false : true,
                                                'addRole': role.roleList[t]['addRole'] == 0 ? false : true,
                                            }
                                        }

                                    }

                                    role.$set(role.areaList, role.areaList)
                                    role.$set(role.dareaList, role.dareaList)

                                    // role.CurrentChange()



                                    if ('area' in role.Request) {
                                        if (role.Request.area in role.areaList) {
                                            role.area = role.Request.area
                                            role.roleData.searchArea = role.area
                                            if ('darea' in role.Request) {
                                                if (role.Request.darea in role.dareaList[role.area].darea) {
                                                    role.darea = role.Request.darea
                                                    role.roleData.searchDarea = role.darea
                                                    role.roleData.searchPlan = role.darea
                                                    role.areaDialog = false
                                                    role.getRoleCount()
                                                        // role.loadDarea()
                                                } else {
                                                    role.$alert('您没有管理该区域/场所的权限，或该区域/场所不存在', '错误', {
                                                        confirmButtonText: '确定',
                                                        type: 'error',
                                                        center: true,
                                                        callback: action => {}
                                                    })
                                                }
                                            }
                                        } else {
                                            role.$alert('您没有管理该区域/场所的权限，或该区域/场所不存在', '错误', {
                                                confirmButtonText: '确定',
                                                type: 'error',
                                                center: true,
                                                callback: action => {}
                                            })
                                        }
                                    } else {
                                        if (sessionStorage.getItem("area") != null) {
                                            if (sessionStorage.getItem("area") in role.areaList) {
                                                if (sessionStorage.getItem("darea") != null) {
                                                    role.area = sessionStorage.getItem("area")
                                                    role.roleData.searchArea = role.area
                                                    if (sessionStorage.getItem("darea") in role.dareaList[role.area].darea) {
                                                        role.darea = sessionStorage.getItem("darea")
                                                        role.roleData.searchPlan = sessionStorage.getItem("darea")
                                                        role.areaDialog = false

                                                    } else {
                                                        role.$alert('默认区域/场所 权限错误，请重新选择', '错误', {
                                                            confirmButtonText: '确定',
                                                            type: 'error',
                                                            center: true,
                                                            callback: action => {
                                                                role.areaDialog = true
                                                            }
                                                        })
                                                    }
                                                }
                                            } else {
                                                role.$alert('默认区域/场所 权限错误，请重新选择', '错误', {
                                                    confirmButtonText: '确定',
                                                    type: 'error',
                                                    center: true,
                                                    callback: action => {
                                                        role.areaDialog = true
                                                    }
                                                })
                                            }
                                        } else if (sessionStorage.getItem("area") == null) {
                                            role.areaDialog = true
                                        }
                                    }
                                    role.CurrentChange()
                                    console.log(role.dareaList)
                                })
                            }

                            // role.getRoleCount()

                        }
                    }
                })
            }
        })
    </script>

    </div>
    <style>
        .table-expand {
            font-size: 0;
        }
        
        .table-expand label {
            width: 50%;
            color: #99a9bf;
        }
        
        .table-expand .el-form-item {
            margin-right: 0;
            margin-bottom: 0;
            width: 100%;
        }
    </style>
    <script type="text/javascript">
        var resetWindow = function() {
            $('#role').css({
                'min-height': $(window).height() - $('#head').height() - $('#foot').height()
            })

            if ($(window).width() <= 995) {
                role.tabPosition = 'top'
                $('#role').css({
                    'margin': '0 10px',
                    'margin-top': '5px'
                })
            } else {
                role.tabPosition = 'left'
                $('#role').css({
                    'margin': '0 5px',
                    'margin-top': '5px'
                })
            }
        }
        $(document).ready(function() {
            resetWindow()
            $(window).resize(function() {
                resetWindow()
            })
        })
    </script>

</html>